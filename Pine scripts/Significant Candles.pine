// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© glenrutherford4

//@version=5
indicator("Significant Candles", overlay = true)

avgPeriods = input.int(20, "Average periods", group = "Technical")
showShavedOpenCandles = input.bool(1, "Show shaved open candles", group = "Technical")
avgRangeMultiplier = input.float(1.0, "Average range multiplier", group = "Technical", step = 0.1)
shavedOpenWickTolerance = input.float(0.02, "Shaved open wick tolerance", group = "Technical", step = 0.01)

isBullish(offset) =>
    close[offset] > open[offset]

upperWickRange = isBullish(0) ? high - close : high - open
lowerWickRange = isBullish(0) ? open - low : close - low
candleRange = high - low
avgRange = ta.sma(candleRange, avgPeriods)
isLargeRange = candleRange >= avgRange * avgRangeMultiplier

isShavedOpenBullishCandle = isBullish(0) and lowerWickRange/candleRange <= shavedOpenWickTolerance and isLargeRange
isShavedOpenBearishCandle = not isBullish(0) and upperWickRange/candleRange <= shavedOpenWickTolerance and isLargeRange

plotshape(isShavedOpenBullishCandle, style=shape.xcross, location=location.belowbar, color=color.yellow, size=size.tiny)
plotshape(isShavedOpenBearishCandle, style=shape.xcross, location=location.abovebar, color=color.yellow, size=size.tiny)
